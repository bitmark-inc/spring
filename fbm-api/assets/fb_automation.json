{
  "pages": [
    {
      "name": "login",
      "detection": "!!document.querySelector(\"input#m_login_email\");",
      "actions": {
        "login": "document.querySelector(\"input#m_login_email\").value = \"%username%\";document.querySelector(\"input#m_login_password\").value = \"%password%\";document.querySelector('button[name=\"login\"]').click();",
        "isLogInFailed": "!!document.querySelector('#login_error') || !!document.querySelector('[data-sigil=\"code-input\"]');"
      }
    },
    {
      "name": "account_picking",
      "detection": "!!document.querySelector('a[href*=\"/login/?ref=dbl&fl\"]');",
      "actions": {
        "pickAnother": "document.querySelector('a[href*=\"/login/?ref=dbl&fl\"]').click()"
      }
    },
    {
      "name": "save_device",
      "detection": "!!document.querySelector('a[href*=\"save-device/cancel\"]');",
      "actions": {
        "notNow": "document.querySelector('a[href*=\"save-device/cancel\"]').click();",
        "ok": "document.querySelector('button[type=\"submit\"]').click();"
      }
    },
    {
      "name": "new_feed",
      "detection": "!!document.querySelector(\"#MComposer\");",
      "actions": {
        "goToSettingsPage": "window.location.href = \"/settings/?entry_point=bookmark\";"
      }
    },
    {
      "name": "settings",
      "urlSignal": "/settings/",
      "detection": "!!document.querySelector('a[href*=\"/dyi/\"]');",
      "actions": {
        "goToArchivePage": "document.querySelector('a[href*=\"/dyi/\"]').click();"
      }
    },
    {
      "name": "archive",
      "detection": "!!document.querySelector('[data-testid=\"dyi/navigation/new_archive\"]');",
      "actions": {
        "selectRequestTab": "document.querySelector('[data-testid=\"dyi/navigation/new_archive\"]').click();",
        "selectDownloadTab": "document.querySelector('[data-testid=\"dyi/navigation/all_archives\"]').click();",
        "selectJSONOption": "\n    (function() {\n      let simulateHTMLEvent = function(element, eventName) {\n        let evt = document.createEvent(\"HTMLEvents\");\n        evt.initEvent(eventName, true, true);\n        element.dispatchEvent(evt);\n      }\n      let selectEl = document.querySelector('select[name=\"format\"]');\n      selectEl.selectedIndex = 1;\n      selectEl.value = 'JSON';\n      simulateHTMLEvent(selectEl, 'change');\n    })();\n  ",
        "setFromTimestamp": "\n    (async function() {\n      let from = new Date(%fromTimestamp%);\n      let fromValue = `${from.getUTCFullYear()}-${from.getUTCMonth() + 1}-${from.getUTCDate()}`;\n    \n      let simulateHTMLEvent = function(element, eventName) {\n        var evt = document.createEvent(\"HTMLEvents\");\n        evt.initEvent(eventName, true, true);\n        element.dispatchEvent(evt);\n      }\n      let simulateEvent = function(element, eventName) {\n        element.dispatchEvent(new Event(eventName, { bubbles: true}));\n      }\n    \n      let selectEl = document.querySelector('select[name=\"date\"]');\n      selectEl.selectedIndex = 1;\n      selectEl.value = 'custom';\n      simulateHTMLEvent(selectEl, 'change');\n    \n      let inputEl = document.querySelectorAll('input[type=\"date\"][min][max]')[0];\n      let nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, \"value\").set;\n      nativeInputValueSetter.call(inputEl, fromValue);\n      simulateEvent(inputEl, 'input');\n    })();\n  ",
        "selectHighResolutionOption": "\n    (function() {\n      let simulateHTMLEvent = function(element, eventName) {\n        let evt = document.createEvent(\"HTMLEvents\");\n        evt.initEvent(eventName, true, true);\n        element.dispatchEvent(evt);\n      }\n      let selectEl = document.querySelector('select[name=\"media_quality\"]');\n      selectEl.selectedIndex = 1;\n      selectEl.value = 'VERY_HIGH';\n      simulateHTMLEvent(selectEl, 'change');\n    })();\n  ",
        "createFile": "document.querySelector('button[data-testid=\"dyi/sections/create\"]').click();",
        "isCreatingFile": "document.querySelector('button[data-testid=\"dyi/sections/create\"]').disabled;",
        "downloadFirstFile": "document.querySelectorAll('button[data-testid*=\"dyi/archives\"]')[0].click();"
      }
    },
    {
      "name": "reauth",
      "detection": "!!document.querySelector('input[data-testid=\"sec_ac_button\"]');",
      "actions": {
        "reauth": "document.querySelector('input[name=\"pass\"]').value = \"%password%\";document.querySelector('input[data-testid=\"sec_ac_button\"]').click();"
      }
    }
  ]
}